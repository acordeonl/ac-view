<link rel="import" href="/bower_components/polymer/polymer.html">
<script>
/**
* Behavior that highlights stuff.
*
* @polymerBehavior
*/
    acLedBehavior= {
        properties:{
            acId:{
                type:Number
            },
            customText:{
                type:Number,
                value:-1
            }
        },
        setTheme: function(e){
            this.customStyle = e ;
            this.updateStyles() ;
            if (this.customText === 0 ) {
                console.log('aja 2');
                var nodeList = Polymer.dom(this.root).querySelectorAll('[note]');
                for (i = 0; i < nodeList.length; i++) {
                    nodeList[i].style.color = this.customStyle['--content-background'] ;
                }
            }
        },
        // Default colors for acLed
        _getAcLedColor: function(acLedState){
            if (acLedState === 1) {
                return '--theme-color1' ;
            }
            if (acLedState === 2) {
                return '--theme-color2' ;
            }
        },
        _getNoteName: function(note){
            var notes = [
                'C',
                'C#',
                'D',
                'Eb',
                'E',
                'F',
                'F#',
                'G',
                'Ab',
                'A',
                'Bb',
                'B'
            ];
            var octave = Math.floor(note / 12);
            var name = notes[note % 12];
            name += octave;
            return name;
        },
        render: function(origin,acLedState){
            if(origin === 'playback' || origin === 'playbackGUI' && this.playbackState !== acLedState){
                if (acLedState !== 0) {
                    this.$$('[playbackAcLed]').style.display = 'block' ;
                    var color = this._getAcLedColor(acLedState) ;
                    if( color.startsWith('--') )
                        color = this.customStyle[color] ;
                    this.$$('[playbackAcLed]').style.backgroundColor = color ;
                }
                else {
                    this.$$('[playbackAcLed]').style.display = 'none' ;
                }
            }
            if(origin === 'instrument' && this.instrumentState !== acLedState) {
                if (acLedState !== 0) {
                    this.$$('[instrumentAcLed]').style.display = 'block' ;
                    this.$$('[instrumentAcLed]').style.backgroundColor = this._getAcLedColor(acLedState);
                }
                else {
                    this.$$('[instrumentAcLed]').style.display = 'none' ;
                }
            }
        },
        resetGUI: function(origin,clearState){
            if(origin==='playback' && clearState ) {
                this.$$('[playbackAcLed]').style.display = 'none' ;
            }
            if(origin==='instrument' && clearState) {
                this.$$('[instrumentAcLed]').style.display = 'none' ;
            }
        },
        init: function(){
            this.async(function(){
                var acLed = this.$$('[acLed]') ;
                if(acLed.getAttribute('dev') !== null && acLed.getAttribute('dev') !== undefined)
                    return ;

                acLed.style.position = 'absolute' ;
                var instrumentAcLed = acLed.cloneNode(true)  ;
                var playbackAcLed  = acLed.cloneNode(true)  ;
                console.log(this.$$('[acLed] [note]'));
                if ( this.$$('[acLed] [note]') === null || this.$$('[acLed] [note]') === undefined ) {
                    var noteElement = document.createElement('div') ;
                    noteElement.setAttribute('note',"") ;
                    noteElement.style.width = '100%';
                    noteElement.style.height = '100%';
                    noteElement.style.position = 'absolute' ;
                    noteElement.style.color = this.customStyle['--content-background'];
                    noteElement.style.fontWeight = '400' ;
                    noteElement.style.fontSize = '18px';
                    noteElement.style.display = 'flex';
                    noteElement.style.justifyContent = 'center';
                    noteElement.style.alignItems = 'center';
                    acLed.appendChild(noteElement) ;
                    instrumentAcLed = acLed.cloneNode(true)  ;
                    playbackAcLed  = acLed.cloneNode(true)  ;
                }
                else{
                    console.log('es custom');
                    this.customText = 1 ;
                }

                var acLedRoot = acLed.parentNode ;
                acLedRoot.removeChild(acLed) ;

                instrumentAcLed.setAttribute('instrumentAcLed',"") ;
                acLedRoot.appendChild (instrumentAcLed) ;
                playbackAcLed.setAttribute('playbackAcLed',"") ;
                acLedRoot.appendChild (playbackAcLed) ;
                this.$$('[playbackAcLed] [note]').setAttribute('playbackNote',"") ;
                this.$$('[instrumentAcLed] [note]').setAttribute('instrumentNote',"") ;

                this.$$('[playbackAcLed]').style.display = 'none';
                this.$$('[instrumentAcLed]').style.display = 'none';

                // testing
                this.$$('[playbackNote]').innerHTML = 'Ab' ;
                this.$$('[instrumentNote]').innerHTML = 'Ab' ;

            }.bind(this) , 0  )  ;
        }
    } ;
</script>
